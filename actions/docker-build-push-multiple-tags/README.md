# Docker Build and Push with Multiple Tags

Composite GitHub Action: Calculate multiple Docker image tags, log in to a registry, set up buildx, and build & push images.

This composite action wraps the `calculate-docker-tags` action to produce a list of tags (newline-separated), converts them into a comma-separated list, and then uses `docker/build-push-action` to build and push the image with those tags.

## When to use
- You want to produce a consistent set of image tags (latest, timestamp, short SHA, release) and push the same image with all tags.
- You want to compose several steps (tag calculation, login, setup buildx, build/push) into a single reusable action.

## Inputs
- `image_name` (required) - Docker image name (e.g. `owner/repo`).
- `dockerfile` (optional) - Path to Dockerfile. Default: `Dockerfile`.
- `context` (optional) - Build context. Default: `.`.
- `push` (optional) - Whether to push the image (`true`/`false`). Default: `true`.
- `docker_username` (required) - Docker registry username (should come from workflow secrets).
- `docker_password` (required) - Docker registry password (should come from workflow secrets).

## Outputs
- `tags` - Comma-separated list of tags generated by the `calculate-docker-tags` action.

Internally the composite action runs the local action `../calculate-docker-tags` to calculate tags and publishes the final `tags` through `GITHUB_OUTPUT`.

## Example usage (in the same repository)

```yaml
# .github/workflows/build.yml
name: Build and Push
on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build and push image
        uses: ./actions/docker-build-push-multiple-tags
        with:
          image_name: ghcr.io/example-owner/example-repo
          docker_username: ${{ secrets.DOCKER_USERNAME }}
          docker_password: ${{ secrets.DOCKER_PASSWORD }}
```

## Example usage (from another repository)
If you want to use this composite action from another repository, publish a release or reference a commit/tag, and update the `uses` to point to the repo path where this action lives, e.g.:

```yaml
uses: shanieMoonlight/git-actions/actions/docker-build-push-multiple-tags@v1.0.0
```

Note: If you use the remote reference, ensure the `calculate-docker-tags` action is also available at the expected path in that repo or change the composite action `uses` accordingly.

## Troubleshooting
- Multiple projects conflict (Nx): If your repo is an Nx workspace, ensure action folders do not conflict with workspace project names. A duplicate project name can cause Nx daemon errors when building the project graph.
- No tags produced: The composite action expects the nested `calculate-docker-tags` action to emit newline-separated tags as output. Use the `Dump action GITHUB_OUTPUT (debug)` step (already included) to inspect the computed value if needed.
- Build failures: Ensure your build environment can run Docker, `docker buildx` is available, and `docker/login-action` credentials are correct.

## Notes
- The composite action intentionally uses a relative path (`../calculate-docker-tags`) so that local runs and CI inside the same repository will use the local action. If you intend to publish this action for external consumers, change this to a public `uses: owner/repo/path@tag` reference and prefer a tag or commit SHA for reproducible behavior.

If you want, I can also add a short `README.md` next to `actions/calculate-docker-tags` describing the JS action and how to build/publish it.
